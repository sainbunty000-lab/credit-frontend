<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Enterprise AI Credit Underwriting</title>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:'Segoe UI';
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

header{
padding:20px;
text-align:center;
font-size:22px;
background:rgba(0,0,0,0.4);
}

.progress-container{
height:6px;
background:#1e293b;
}

.progress-bar{
height:6px;
background:#00c6ff;
transition:width 0.5s ease;
}

.nav{
display:flex;
justify-content:space-around;
background:rgba(0,0,0,0.5);
padding:10px;
}

.nav button{
background:none;
border:none;
color:white;
font-weight:bold;
cursor:pointer;
opacity:0.5;
}

.nav button.active{
color:#00eaff;
opacity:1;
}

.nav button.locked{
opacity:0.2;
cursor:not-allowed;
}

.container{
padding:20px;
max-width:1200px;
margin:auto;
}

.card{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(10px);
border-radius:15px;
padding:20px;
margin-bottom:20px;
}

button{
background:linear-gradient(45deg,#00c6ff,#0072ff);
border:none;
padding:8px 15px;
border-radius:8px;
color:white;
cursor:pointer;
margin-top:10px;
}

.green{color:#00ff88;}
.orange{color:#ffcc00;}
.red{color:#ff4d4d;}
</style>
</head>

<body>

<header>Enterprise AI Credit Underwriting Platform</header>

<div class="progress-container">
<div id="progress" class="progress-bar"></div>
</div>

<div id="root" class="container"></div>

<script type="text/babel">

const API_URL="https://credit-backend-yh78.onrender.com";

function App(){

const [slide,setSlide]=React.useState(1);
const [maxSlide,setMaxSlide]=React.useState(1);
const [bs,setBS]=React.useState(null);
const [pl,setPL]=React.useState(null);
const [bank,setBank]=React.useState(null);
const [result,setResult]=React.useState(null);

const totalSlides=6;

const riskColor=(score)=>{
if(score>=80) return "green";
if(score>=60) return "orange";
return "red";
};

const formatCurrency=(n)=>"‚Çπ"+Number(n||0).toLocaleString("en-IN");

const changeSlide=(n)=>{
if(n<=maxSlide) setSlide(n);
};

React.useEffect(()=>{
document.getElementById("progress").style.width=
(slide/totalSlides*100)+"%";
},[slide]);

const runFull=async()=>{
if(!bs||!pl||!bank){
alert("Upload all three documents");
return;
}

const fd=new FormData();
fd.append("bs_file",bs);
fd.append("pl_file",pl);
fd.append("bank_file",bank);

const res=await fetch(API_URL+"/full-analysis",{
method:"POST",
body:fd
});

const data=await res.json();
setResult(data);
setSlide(2);
setMaxSlide(6);
};

React.useEffect(()=>{
if(slide===6 && result){

if(window.chart1) window.chart1.destroy();
if(window.chart2) window.chart2.destroy();
if(window.chart3) window.chart3.destroy();

window.chart1=new Chart(document.getElementById("chart1"),{
type:"bar",
data:{
labels:["Agriculture","Working Capital"],
datasets:[{
data:[
result.Eligibility.Agri_Limit,
result.Eligibility.Working_Capital_Limit
],
backgroundColor:["#00ff88","#00c6ff"]
}]
},
options:{plugins:{legend:{display:false}}}
});

window.chart2=new Chart(document.getElementById("chart2"),{
type:"bar",
data:{
labels:["Risk Score"],
datasets:[{
data:[result.Risk.Score],
backgroundColor:[
result.Risk.Score>=80?"#00ff88":
result.Risk.Score>=60?"#ffcc00":"#ff4d4d"
]
}]
},
options:{indexAxis:"y",scales:{x:{max:100}}}
});

window.chart3=new Chart(document.getElementById("chart3"),{
type:"radar",
data:{
labels:["Mismatch %","Accuracy Score"],
datasets:[{
data:[
result.Mismatch_%,
result.Accuracy_Score
],
backgroundColor:"rgba(0,198,255,0.3)",
borderColor:"#00c6ff"
}]
}
});

}
},[slide,result]);

return(
<div>

<div className="nav">
<button onClick={()=>changeSlide(1)} className={slide===1?"active":maxSlide<1?"locked":""}>Upload</button>
<button onClick={()=>changeSlide(2)} className={slide===2?"active":maxSlide<2?"locked":""}>Consistency</button>
<button onClick={()=>changeSlide(3)} className={slide===3?"active":maxSlide<3?"locked":""}>Eligibility</button>
<button onClick={()=>changeSlide(4)} className={slide===4?"active":maxSlide<4?"locked":""}>Risk</button>
<button onClick={()=>changeSlide(5)} className={slide===5?"active":maxSlide<5?"locked":""}>AI</button>
<button onClick={()=>changeSlide(6)} className={slide===6?"active":maxSlide<6?"locked":""}>Analytics</button>
</div>

{slide===1 && (
<div className="card">
<h3>Upload Financial Documents</h3>
<p>Balance Sheet</p>
<input type="file" onChange={(e)=>setBS(e.target.files[0])}/>
<p>P&L Statement</p>
<input type="file" onChange={(e)=>setPL(e.target.files[0])}/>
<p>Bank Statement</p>
<input type="file" onChange={(e)=>setBank(e.target.files[0])}/>
<button onClick={runFull}>Run Underwriting</button>
</div>
)}

{slide===2 && result && (
<div className="card">
<h3>Consistency Dashboard</h3>
<p>Declared Sales: {formatCurrency(result.Parsed_Data.Sales)}</p>
<p>Bank Turnover: {formatCurrency(result.Parsed_Data.Bank_Turnover)}</p>
<p>Mismatch %: {result.Mismatch_%}%</p>
<p>Accuracy Score: {result.Accuracy_Score}%</p>
{result.Fraud_Flags.length>0 &&
<p className="red">Fraud Flags: {result.Fraud_Flags.join(", ")}</p>}
<button onClick={()=>setSlide(3)}>Next</button>
</div>
)}

{slide===3 && result && (
<div className="card">
<h3>Eligibility</h3>
<p>üåæ Agriculture: {formatCurrency(result.Eligibility.Agri_Limit)}</p>
<p>üè≠ Working Capital: {formatCurrency(result.Eligibility.Working_Capital_Limit)}</p>
<button onClick={()=>setSlide(4)}>Next</button>
</div>
)}

{slide===4 && result && (
<div className="card">
<h3>Risk & Decision</h3>
<p>Risk Score: <span className={riskColor(result.Risk.Score)}>{result.Risk.Score}</span></p>
<p>Grade: {result.Risk.Grade}</p>
<p>Decision: {result.Risk.Decision}</p>
<button onClick={()=>setSlide(5)}>Next</button>
</div>
)}

{slide===5 && result && (
<div className="card">
<h3>AI Underwriting Narrative</h3>
<p><b>Executive:</b> {result.AI_Summary.Executive_Summary}</p>
<p><b>Financial:</b> {result.AI_Summary.Financial_Assessment}</p>
<p><b>Banking:</b> {result.AI_Summary.Banking_Assessment}</p>
<p><b>Fraud:</b> {result.AI_Summary.Fraud_Observation}</p>
<p><b>Recommendation:</b> {result.AI_Summary.Final_Recommendation}</p>

<a href={API_URL+"/generate-cam/"+result.Case_ID} target="_blank">
<button>Download CAM Report</button>
</a>

<button onClick={()=>setSlide(6)}>View Analytics</button>
</div>
)}

{slide===6 && result && (
<div className="card">
<h3>Analytics Dashboard</h3>
<canvas id="chart1" height="120"></canvas>
<br/>
<canvas id="chart2" height="80"></canvas>
<br/>
<canvas id="chart3" height="120"></canvas>
</div>
)}

</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>

</body>
</html>
