<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Enterprise Underwriting System</title>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<style>
body{
margin:0;
font-family:'Segoe UI';
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

header{
padding:20px;
text-align:center;
font-size:22px;
background:rgba(0,0,0,0.4);
}

.nav{
display:flex;
justify-content:space-around;
background:rgba(0,0,0,0.5);
padding:10px;
}

.nav button{
background:none;
border:none;
color:white;
font-weight:bold;
cursor:pointer;
}

.nav button.active{
color:#00eaff;
}

.container{
padding:20px;
max-width:1200px;
margin:auto;
}

.card{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(10px);
border-radius:15px;
padding:20px;
margin-bottom:20px;
}

button{
background:linear-gradient(45deg,#00c6ff,#0072ff);
border:none;
padding:8px 15px;
border-radius:8px;
color:white;
cursor:pointer;
margin-top:10px;
}

.green{color:#00ff88;}
.orange{color:#ffcc00;}
.red{color:#ff4d4d;}
</style>
</head>

<body>

<header>AI Credit Underwriting Enterprise Suite</header>

<div id="root" class="container"></div>

<script type="text/babel">

const API_URL="https://credit-backend-yh78.onrender.com";

function App(){

const [slide,setSlide]=React.useState(1);
const [bs,setBS]=React.useState(null);
const [pl,setPL]=React.useState(null);
const [bank,setBank]=React.useState(null);
const [result,setResult]=React.useState(null);
const [full,setFull]=React.useState(null);

const riskColor=(score)=>{
if(score>=80) return "green";
if(score>=60) return "orange";
return "red";
};

const formatCurrency=(n)=>"‚Çπ"+Number(n||0).toLocaleString("en-IN");

const runFull=async()=>{
const fd=new FormData();
fd.append("bs_file",bs);
fd.append("pl_file",pl);
fd.append("bank_file",bank);

const res=await fetch(API_URL+"/full-analysis",{method:"POST",body:fd});
const data=await res.json();
setFull(data);
setSlide(2);
};

const runEligibility=async()=>{
if(!full) return alert("Run full analysis first");

const payload={
sales:full.Parsed_Data.Sales,
pat:full.Parsed_Data.PAT,
dep:0,
stock:full.Parsed_Data.Stock,
debtors:full.Parsed_Data.Debtors,
creditors:full.Parsed_Data.Creditors,
loan_req:0,
emi:0,
undocumented:0,
bounce:full.Parsed_Data.Bounce_Count
};

const res=await fetch(API_URL+"/analyze",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(payload)
});
const data=await res.json();
setResult(data);
setSlide(3);
};

return(
<div>

<div className="nav">
<button onClick={()=>setSlide(1)} className={slide===1?"active":""}>Upload</button>
<button onClick={()=>setSlide(2)} className={slide===2?"active":""}>Consistency</button>
<button onClick={()=>setSlide(3)} className={slide===3?"active":""}>Eligibility</button>
<button onClick={()=>setSlide(4)} className={slide===4?"active":""}>Risk</button>
<button onClick={()=>setSlide(5)} className={slide===5?"active":""}>Final</button>
</div>

{/* Slide 1 */}
{slide===1 && (
<div className="card">
<h3>Upload Complete Financial Set</h3>

<p>Balance Sheet</p>
<input type="file" onChange={(e)=>setBS(e.target.files[0])}/>

<p>P&L Statement</p>
<input type="file" onChange={(e)=>setPL(e.target.files[0])}/>

<p>Bank Statement</p>
<input type="file" onChange={(e)=>setBank(e.target.files[0])}/>

<button onClick={runFull}>Run Full Underwriting</button>
</div>
)}

{/* Slide 2 */}
{slide===2 && full && (
<div className="card">
<h3>Data Consistency Dashboard</h3>

<p>Declared Sales: {formatCurrency(full.Parsed_Data.Sales)}</p>
<p>Bank Turnover: {formatCurrency(full.Parsed_Data.Bank_Turnover)}</p>
<p>Mismatch %: {full.Cross_Verification.Turnover_Mismatch_%}%</p>
<p>Status: {full.Cross_Verification.Verification_Status}</p>

<button onClick={runEligibility}>Proceed to Eligibility</button>
</div>
)}

{/* Slide 3 */}
{slide===3 && result && (
<div className="card">
<h3>Eligibility Engine</h3>

<p>üåæ Agriculture Limit: {formatCurrency(result.Agri_Eligible_Limit)}</p>
<p>üè≠ Working Capital Limit: {formatCurrency(result.Working_Capital_Limit)}</p>

<button onClick={()=>setSlide(4)}>Proceed to Risk</button>
</div>
)}

{/* Slide 4 */}
{slide===4 && result && (
<div className="card">
<h3>Risk & Fraud Intelligence</h3>

<p>Risk Score: <span className={riskColor(result.Risk_Score)}>{result.Risk_Score}</span></p>
<p>Risk Grade: {result.Risk_Grade}</p>
<p>Banking Health: {result.Banking_Health}</p>
<p>Decision: {result.Decision}</p>

<button onClick={()=>setSlide(5)}>Generate Final Report</button>
</div>
)}

{/* Slide 5 */}
{slide===5 && result && (
<div className="card">
<h3>AI Underwriting Summary</h3>

<p>
The applicant shows {result.Risk_Grade} risk profile with a 
current ratio of {result.Current_Ratio} and profit margin of {result.Profit_Margin}%.
Banking conduct classified as {result.Banking_Health}.
Recommended decision: {result.Decision}.
</p>

<a href={API_URL+"/generate-cam/"+result.Case_ID} target="_blank">
<button>Download CAM Report</button>
</a>
</div>
)}

</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>

</body>
</html>
