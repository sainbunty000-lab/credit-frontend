<!DOCTYPE html>
<html>
<head>
<title>Agri / WC Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI;
background:#0f172a;
color:white;
display:flex;
}

/* Sidebar */
.sidebar{
width:240px;
background:#111827;
height:100vh;
padding:20px;
position:fixed;
}

.sidebar h2{
color:#22c55e;
margin-bottom:30px;
}

.sidebar button{
width:100%;
padding:10px;
margin-bottom:10px;
background:#1f2937;
border:none;
color:white;
cursor:pointer;
border-radius:6px;
}

.sidebar button:hover{
background:#22c55e;
}

/* Main */
.main{
margin-left:260px;
padding:20px;
width:100%;
}

.card{
background:#1e293b;
padding:20px;
border-radius:10px;
margin-bottom:20px;
}

input{
width:100%;
padding:8px;
margin-bottom:10px;
border:none;
border-radius:5px;
}

button.run{
background:#22c55e;
border:none;
padding:10px;
width:100%;
font-weight:bold;
cursor:pointer;
border-radius:6px;
margin-top:10px;
}

.kpi{
display:flex;
gap:20px;
flex-wrap:wrap;
margin-bottom:20px;
}

.kpi div{
background:#0ea5e9;
padding:15px;
border-radius:8px;
min-width:150px;
text-align:center;
}
</style>
</head>

<body>

<div class="sidebar">
<h2>Agri / WC</h2>
<button onclick="show('wc')">Working Capital</button>
<button onclick="show('tl')">Term Loan</button>
<button onclick="show('agri')">Agriculture</button>
<button onclick="show('dashboard')">Dashboard</button>
<button class="run" onclick="runAnalysis()">▶ Run Analysis</button>
</div>

<div class="main">

<div id="wc" class="card">
<h3>Working Capital (RBI)</h3>
<input id="turnover" placeholder="Turnover">
<input id="inventory" placeholder="Inventory">
<input id="debtors" placeholder="Debtors">
<input id="creditors" placeholder="Creditors">
<button class="run" onclick="runAnalysis()">Run Analysis</button>
</div>

<div id="tl" class="card" style="display:none">
<h3>Term Loan (DSCR)</h3>
<input id="net_profit" placeholder="Net Profit">
<input id="depreciation" placeholder="Depreciation">
<input id="monthly_emi" placeholder="Monthly EMI">
<button class="run" onclick="runAnalysis()">Run Analysis</button>
</div>

<div id="agri" class="card" style="display:none">
<h3>Agriculture (Your Model)</h3>
<input id="tax_paid" placeholder="Tax Paid">
<input id="undoc" placeholder="Undocumented Income">
<input id="requested" placeholder="Requested Loan">
<button class="run" onclick="runAnalysis()">Run Analysis</button>
</div>

<div id="dashboard" style="display:none">

<div class="kpi">
<div id="k_wc">WC ₹0</div>
<div id="k_agri">Agri ₹0</div>
<div id="k_dscr">DSCR 0</div>
<div id="k_final">Final ₹0</div>
</div>

<div class="card">
<canvas id="chart"></canvas>
</div>

</div>

</div>

<script>
const API_URL = "https://credit-backend-production-6a6d.up.railway.app/analyze";

function show(section){
["wc","tl","agri","dashboard"].forEach(id=>{
document.getElementById(id).style.display="none";
});
document.getElementById(section).style.display="block";
}

let chart;

async function runAnalysis(){

const payload = {
turnover: parseFloat(document.getElementById("turnover").value)||0,
inventory: parseFloat(document.getElementById("inventory").value)||0,
debtors: parseFloat(document.getElementById("debtors").value)||0,
creditors: parseFloat(document.getElementById("creditors").value)||0,
net_profit: parseFloat(document.getElementById("net_profit").value)||0,
depreciation: parseFloat(document.getElementById("depreciation").value)||0,
monthly_emi: parseFloat(document.getElementById("monthly_emi").value)||0,
tax_paid: parseFloat(document.getElementById("tax_paid").value)||0,
undocumented_income: parseFloat(document.getElementById("undoc").value)||0,
requested_loan: parseFloat(document.getElementById("requested").value)||0
};

const res = await fetch(API_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(payload)
});

const data = await res.json();

document.getElementById("k_wc").innerHTML = "WC ₹"+(data.wc_eligible || 0);
document.getElementById("k_agri").innerHTML = "Agri ₹"+(data.agri_eligible || 0);
document.getElementById("k_dscr").innerHTML = "DSCR "+(data.dscr || 0);
document.getElementById("k_final").innerHTML = "Final ₹"+(data.final_recommendation || 0);

if(chart) chart.destroy();

chart = new Chart(document.getElementById("chart"),{
type:"bar",
data:{
labels:["WC","Agri","Final"],
datasets:[{
label:"Eligibility",
data:[
data.wc_eligible || 0,
data.agri_eligible || 0,
data.final_recommendation || 0
],
backgroundColor:["#0ea5e9","#22c55e","#ef4444"]
}]
}
});

show("dashboard");
}
</script>

</body>
</html>
