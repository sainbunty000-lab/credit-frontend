<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agri / WC Calculator</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#0f172a;
    color:white;
}
header {
    padding:20px;
    text-align:center;
    font-size:24px;
    font-weight:bold;
    background:linear-gradient(90deg,#0ea5e9,#22c55e);
}
.container {
    padding:20px;
    max-width:900px;
    margin:auto;
}
.card {
    background:#1e293b;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
}
input[type=file] {
    width:100%;
    margin:10px 0;
}
button {
    width:100%;
    padding:12px;
    background:#22c55e;
    border:none;
    color:white;
    font-weight:bold;
    border-radius:8px;
    cursor:pointer;
}
button:hover {
    opacity:0.9;
}
.loader {
    display:none;
    text-align:center;
    margin-top:15px;
}
.result-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:15px;
}
.metric {
    background:#334155;
    padding:15px;
    border-radius:10px;
}
canvas {
    margin-top:20px;
    background:white;
    border-radius:10px;
}
.memo {
    white-space:pre-line;
    background:#111827;
    padding:15px;
    border-radius:10px;
}
</style>
</head>

<body>

<header>üè¶ Agri / WC Calculator</header>

<div class="container">

<div class="card">
<h3>Upload Financial Documents</h3>

<label>Balance Sheet (Mandatory)</label>
<input type="file" id="bsFile" required>

<label>Profit & Loss (Mandatory)</label>
<input type="file" id="plFile" required>

<label>Bank Statement (Optional)</label>
<input type="file" id="bankFile">

<button onclick="runAnalysis()">Run Analysis</button>

<div class="loader" id="loader">Processing Financial Data...</div>
</div>

<div class="card" id="results" style="display:none;">

<h3>Financial Summary</h3>

<div class="result-grid" id="metrics"></div>

<canvas id="financeChart"></canvas>

<h3>AI Credit Memo</h3>
<div class="memo" id="memo"></div>

</div>

</div>

<script>

const API_URL = "https://YOUR-RAILWAY-URL.up.railway.app"; // üî• REPLACE THIS

let chartInstance = null;

async function runAnalysis() {

    const bsFile = document.getElementById("bsFile").files[0];
    const plFile = document.getElementById("plFile").files[0];
    const bankFile = document.getElementById("bankFile").files[0];

    if (!bsFile || !plFile) {
        alert("Balance Sheet and P&L are mandatory.");
        return;
    }

    const formData = new FormData();
    formData.append("bs_file", bsFile);
    formData.append("pl_file", plFile);

    if (bankFile) {
        formData.append("bank_file", bankFile);
    }

    document.getElementById("loader").style.display = "block";
    document.getElementById("results").style.display = "none";

    try {

        const response = await fetch(API_URL + "/analyze", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        document.getElementById("loader").style.display = "none";
        document.getElementById("results").style.display = "block";

        displayResults(data);

    } catch (error) {
        console.error(error);
        alert("Server Error.");
        document.getElementById("loader").style.display = "none";
    }
}

function displayResults(data) {

    const metricsDiv = document.getElementById("metrics");

    metricsDiv.innerHTML = `
        <div class="metric">Sales: ‚Çπ${data.Sales}</div>
        <div class="metric">NWC: ‚Çπ${data.NWC}</div>
        <div class="metric">Current Ratio: ${data.Current_Ratio}</div>
        <div class="metric">MPBF: ‚Çπ${data.MPBF}</div>
        <div class="metric">WC Limit: ‚Çπ${data.Working_Capital_Limit}</div>
        <div class="metric">Agri Limit: ‚Çπ${data.Agri_Limit}</div>
        <div class="metric">Risk Score: ${data.Risk_Score}</div>
        <div class="metric">Decision: ${data.Decision}</div>
    `;

    document.getElementById("memo").innerText = data.Memo;

    renderChart(data);
}

function renderChart(data) {

    const ctx = document.getElementById("financeChart").getContext("2d");

    if (chartInstance) {
        chartInstance.destroy();
    }

    chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Sales','MPBF','WC Limit','Agri Limit'],
            datasets: [{
                label: 'Financial Values',
                data: [
                    data.Sales,
                    data.MPBF,
                    data.Working_Capital_Limit,
                    data.Agri_Limit
                ],
                backgroundColor: [
                    '#0ea5e9',
                    '#f59e0b',
                    '#22c55e',
                    '#ef4444'
                ]
            }]
        },
        options: {
            responsive:true,
            plugins:{
                legend:{display:false}
            }
        }
    });
}

</script>

</body>
</html>
