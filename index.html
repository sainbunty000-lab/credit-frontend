<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agri Credit Engine</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
margin:0;
font-family:'Segoe UI';
background:#0b1120;
color:white;
display:flex;
}

/* ---------- SIDEBAR ---------- */

.sidebar{
width:250px;
height:100vh;
background:linear-gradient(180deg,#0f172a,#111827);
padding:25px 15px;
position:fixed;
box-shadow:2px 0 15px rgba(0,0,0,0.6);
}

.sidebar h2{
color:#22c55e;
margin-bottom:30px;
}

.menu-btn{
width:100%;
padding:12px;
margin-bottom:12px;
border-radius:8px;
border:none;
background:#1e293b;
color:#cbd5e1;
font-weight:600;
cursor:pointer;
transition:0.3s;
}

.menu-btn:hover{
background:#22c55e;
color:black;
}

.run-btn{
background:#22c55e;
color:black;
font-weight:700;
}

/* ---------- MAIN ---------- */

.main{
margin-left:270px;
padding:30px;
width:100%;
}

/* ---------- SLIDES ---------- */

.slide{
display:none;
animation:fade 0.3s ease-in-out;
}

@keyframes fade{
from{opacity:0}
to{opacity:1}
}

/* ---------- CARDS ---------- */

.card{
background:#111827;
padding:20px;
border-radius:12px;
margin-bottom:20px;
box-shadow:0 0 15px rgba(0,0,0,0.4);
}

input{
width:100%;
padding:10px;
margin-bottom:12px;
border:none;
border-radius:6px;
background:#1e293b;
color:white;
}

/* ---------- KPI ---------- */

.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:15px;
margin-bottom:25px;
}

.kpi{
padding:20px;
border-radius:10px;
text-align:center;
font-weight:700;
font-size:18px;
}

.green{background:#16a34a;}
.blue{background:#2563eb;}
.orange{background:#f59e0b;}
.red{background:#dc2626;}

</style>
</head>

<body>

<div class="sidebar">
<h2>Credit Engine</h2>

<button class="menu-btn" onclick="showSlide('wc')">Working Capital</button>
<button class="menu-btn" onclick="showSlide('tl')">Term Loan</button>
<button class="menu-btn" onclick="showSlide('agri')">Agriculture</button>
<button class="menu-btn" onclick="showSlide('dashboard')">Dashboard</button>

<button class="menu-btn run-btn" onclick="runAnalysis()">Run Analysis</button>

</div>

<div class="main">

<!-- WC -->
<div id="wc" class="slide card">
<h3>Working Capital</h3>
<input id="turnover" placeholder="Turnover">
<input id="inventory" placeholder="Inventory">
<input id="debtors" placeholder="Debtors">
<input id="creditors" placeholder="Creditors">
</div>

<!-- TL -->
<div id="tl" class="slide card">
<h3>Term Loan</h3>
<input id="net_profit" placeholder="Net Profit">
<input id="depreciation" placeholder="Depreciation">
<input id="monthly_emi" placeholder="Monthly EMI">
</div>

<!-- AGRI -->
<div id="agri" class="slide card">
<h3>Agriculture</h3>
<input id="tax_paid" placeholder="Tax Paid">
<input id="undoc" placeholder="Undocumented Income">
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="slide">

<div class="kpi-grid">
<div id="wc_kpi" class="kpi green">WC ₹0</div>
<div id="tl_kpi" class="kpi blue">TL ₹0</div>
<div id="agri_kpi" class="kpi orange">Agri ₹0</div>
<div id="risk_kpi" class="kpi red">Risk 0</div>
</div>

<div class="card">
<canvas id="resultChart"></canvas>
</div>

<div class="card" id="summaryBox"></div>

</div>

</div>

<script>

const API="https://credit-backend-production-6a6d.up.railway.app/analyze";

let chart;
let results={};

function showSlide(id){
document.querySelectorAll('.slide').forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}

showSlide("wc");

async function runAnalysis(){

let payload={
turnover:+turnover.value||0,
inventory:+inventory.value||0,
debtors:+debtors.value||0,
creditors:+creditors.value||0,
net_profit:+net_profit.value||0,
depreciation:+depreciation.value||0,
monthly_emi:+monthly_emi.value||0,
tax_paid:+tax_paid.value||0,
undocumented_income:+undoc.value||0
};

let res=await fetch(API,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(payload)
});

results=await res.json();

updateDashboard();
showSlide("dashboard");
}

function updateDashboard(){

let wc=results.wc||0;
let tl=results.tl_eligible||0;
let agri=results.agri_eligible||0;
let dscr=results.dscr||0;
let cash=results.cash_accrual||0;

wc_kpi.innerHTML="WC ₹"+wc;
tl_kpi.innerHTML="TL ₹"+tl;
agri_kpi.innerHTML="Agri ₹"+agri;

let risk=dscr>1.25?85:dscr>1?65:40;
risk_kpi.innerHTML="Risk "+risk;

if(chart) chart.destroy();

chart=new Chart(document.getElementById("resultChart"),{
type:'bar',
data:{
labels:["Working Capital","Term Loan","Agriculture"],
datasets:[{
label:"Eligibility",
data:[wc,tl,agri],
backgroundColor:["#16a34a","#2563eb","#f59e0b"]
}]
},
options:{
responsive:true,
plugins:{
legend:{display:true}
}
}
});

summaryBox.innerHTML=`
<b>DSCR:</b> ${dscr}<br>
<b>Cash Accrual:</b> ₹${cash}<br>
<b>Final Recommended:</b> ₹${Math.max(wc,tl,agri)}<br>
<b>Decision:</b> ${risk>60?"APPROVE":"REVIEW"}
`;
}

</script>

</body>
</html>
