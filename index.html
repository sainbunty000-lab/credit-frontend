<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>AI Underwriting Intelligence Suite</title>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family: 'Segoe UI', sans-serif;
background:#0f172a;
color:white;
}

.app{
display:flex;
height:100vh;
}

.sidebar{
width:240px;
background:#111827;
padding:20px;
display:flex;
flex-direction:column;
}

.sidebar h2{
margin-bottom:30px;
font-size:18px;
color:#38bdf8;
}

.sidebar button{
background:none;
border:none;
color:#cbd5e1;
text-align:left;
padding:10px 0;
cursor:pointer;
font-size:14px;
}

.sidebar button.active{
color:#38bdf8;
font-weight:bold;
}

.content{
flex:1;
padding:30px;
overflow:auto;
}

.card{
background:#1e293b;
padding:20px;
border-radius:12px;
margin-bottom:20px;
}

.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:15px;
}

.kpi{
background:#0f172a;
padding:15px;
border-radius:10px;
}

button.primary{
background:#38bdf8;
border:none;
padding:10px 15px;
border-radius:8px;
cursor:pointer;
color:black;
font-weight:bold;
}

.green{color:#22c55e;}
.orange{color:#facc15;}
.red{color:#ef4444;}
.small{font-size:13px;color:#94a3b8;}
</style>
</head>

<body>

<div id="root"></div>

<script type="text/babel">

const API_URL="https://credit-backend-yh78.onrender.com";

function App(){

const [step,setStep]=React.useState(1);
const [bs,setBS]=React.useState(null);
const [pl,setPL]=React.useState(null);
const [bank,setBank]=React.useState(null);
const [result,setResult]=React.useState(null);

const formatCurrency=(n)=>"â‚¹"+Number(n||0).toLocaleString("en-IN");

const riskColor=(score)=>{
if(score>=80) return "green";
if(score>=60) return "orange";
return "red";
};

const runAnalysis=async()=>{
if(!bs||!pl||!bank){
alert("Upload all documents");
return;
}

const fd=new FormData();
fd.append("bs_file",bs);
fd.append("pl_file",pl);
fd.append("bank_file",bank);

const res=await fetch(API_URL+"/full-analysis",{method:"POST",body:fd});
const data=await res.json();
setResult(data);
setStep(2);
};

React.useEffect(()=>{
if(step===4 && result){

if(window.chart) window.chart.destroy();

window.chart=new Chart(document.getElementById("eligChart"),{
type:"bar",
data:{
labels:["WC Limit"],
datasets:[{
data:[result.Working_Capital_Limit],
backgroundColor:"#38bdf8"
}]
}
});

}
},[step,result]);

return(
<div className="app">

<div className="sidebar">
<h2>Underwriting Suite</h2>
<button className={step===1?"active":""} onClick={()=>setStep(1)}>Upload</button>
<button className={step===2?"active":""} onClick={()=>setStep(2)}>Consistency</button>
<button className={step===3?"active":""} onClick={()=>setStep(3)}>Risk</button>
<button className={step===4?"active":""} onClick={()=>setStep(4)}>Analytics</button>
</div>

<div className="content">

{step===1 && (
<div className="card">
<h3>Upload Financial Documents</h3>

<p className="small">Balance Sheet</p>
<input type="file" onChange={(e)=>setBS(e.target.files[0])}/>

<p className="small">P&L Statement</p>
<input type="file" onChange={(e)=>setPL(e.target.files[0])}/>

<p className="small">Bank Statement</p>
<input type="file" onChange={(e)=>setBank(e.target.files[0])}/>

<br/><br/>
<button className="primary" onClick={runAnalysis}>Run Structured Analysis</button>
</div>
)}

{step===2 && result && (
<>
<div className="kpi-grid">
<div className="kpi">
<div className="small">Bank Turnover</div>
<div>{formatCurrency(result.Bank_Turnover)}</div>
</div>

<div className="kpi">
<div className="small">Mismatch %</div>
<div>{result.Mismatch_%}%</div>
</div>

<div className="kpi">
<div className="small">Parsing Confidence</div>
<div>{result.Parsing_Confidence}%</div>
</div>
</div>

<div className="card">
<h3>Working Capital Eligibility</h3>
<h2>{formatCurrency(result.Working_Capital_Limit)}</h2>
</div>
</>
)}

{step===3 && result && (
<div className="card">
<h3>Risk Assessment</h3>

<p>Risk Score:
<span className={riskColor(result.Risk_Score)}>
 {result.Risk_Score}
</span>
</p>

<p>Decision: {result.Decision}</p>
<p>Profit Margin: {result.Profit_Margin}%</p>
<p>Current Ratio: {result.Current_Ratio}</p>
</div>
)}

{step===4 && result && (
<div className="card">
<h3>Analytics</h3>
<canvas id="eligChart"></canvas>
</div>
)}

</div>

</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>

</body>
</html>
