<!DOCTYPE html>
<html>
<head>
<title>Agri / WC Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

header{
padding:20px;
text-align:center;
font-size:22px;
font-weight:bold;
}

.container{
padding:20px;
max-width:1000px;
margin:auto;
}

.card{
background:rgba(255,255,255,0.08);
padding:20px;
border-radius:12px;
margin-bottom:20px;
backdrop-filter:blur(10px);
}

input{
width:100%;
padding:8px;
margin-bottom:10px;
border:none;
border-radius:6px;
}

button{
width:100%;
padding:10px;
border:none;
border-radius:6px;
background:#2ecc71;
font-weight:bold;
cursor:pointer;
}

.result{
margin-top:15px;
font-size:14px;
}
</style>
</head>

<body>

<header>ðŸŒ¾ Agri / WC Calculator</header>

<div class="container">

<div class="card">
<h3>Financial Inputs</h3>
<input id="turnover" placeholder="Annual Turnover">
<input id="net_profit" placeholder="Net Profit">
<input id="depreciation" placeholder="Depreciation">
<input id="tax_paid" placeholder="Tax Paid">
<input id="inventory" placeholder="Inventory">
<input id="debtors" placeholder="Debtors">
<input id="creditors" placeholder="Creditors">
<input id="annual_installment" placeholder="Annual Installment (TL)">
<input id="undoc" placeholder="Undocumented Income">
<input id="existing_emi" placeholder="Existing EMI">
<input id="requested" placeholder="Requested Loan">

<button onclick="runAnalysis()">Run Analysis</button>

<div class="result" id="output"></div>
</div>

<div class="card">
<canvas id="chart"></canvas>
</div>

</div>

<script>

const API_URL ="https://credit-backend-production-6a6d.up.railway.app/";

let chart;

async function runAnalysis(){

const payload = {
turnover: parseFloat(turnover.value)||0,
net_profit: parseFloat(net_profit.value)||0,
depreciation: parseFloat(depreciation.value)||0,
tax_paid: parseFloat(tax_paid.value)||0,
inventory: parseFloat(inventory.value)||0,
debtors: parseFloat(debtors.value)||0,
creditors: parseFloat(creditors.value)||0,
annual_installment: parseFloat(annual_installment.value)||0,
undocumented_income: parseFloat(undoc.value)||0,
existing_emi: parseFloat(existing_emi.value)||0,
requested_loan: parseFloat(requested.value)||0
};

const res = await fetch(API_URL,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify(payload)
});

const data = await res.json();

output.innerHTML = `
Working Capital: â‚¹ ${data.working_capital}<br>
MPBF: â‚¹ ${data.mpbf}<br>
Turnover Method: â‚¹ ${data.turnover_method}<br>
Current Ratio: ${data.current_ratio}<br>
DSCR: ${data.dscr}<br>
Agriculture Eligible: â‚¹ ${data.agriculture_eligible}<br>
Monthly Surplus: â‚¹ ${data.monthly_surplus}<br>
Final Recommended: â‚¹ ${data.final_recommendation}
`;

if(chart) chart.destroy();

chart = new Chart(document.getElementById("chart"),{
type:"bar",
data:{
labels:["WC","Agri","Final"],
datasets:[{
label:"Eligibility",
data:[
data.working_capital,
data.agriculture_eligible,
data.final_recommendation
],
backgroundColor:["#3498db","#2ecc71","#e74c3c"]
}]
}
});

}

</script>

</body>
</html>
