<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agri / WC Calculator</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:rgba(255,255,255,0.08);
  --text:#f1f5f9;
  --accent:#2563eb;
}
.light{
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --accent:#1e40af;
}
body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  padding:10px 15px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:var(--accent);
  color:#fff;
}
.card{
  background:var(--card);
  padding:20px;
  margin:20px;
  border-radius:10px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:15px;
}
input{
  width:100%;
  padding:8px;
  margin-bottom:10px;
}
canvas{
  max-width:100%;
}
</style>
</head>

<body>

<header>
<h2>Agri / WC Calculator</h2>
<button onclick="toggleMode()">Toggle Mode</button>
</header>

<div class="card">
<h3>Working Capital</h3>
<div class="grid">
<input id="turnover" placeholder="Turnover">
<input id="inventory" placeholder="Inventory">
<input id="debtors" placeholder="Debtors">
<input id="creditors" placeholder="Creditors">
</div>
</div>

<div class="card">
<h3>Term Loan</h3>
<div class="grid">
<input id="tl_profit" placeholder="Net Profit">
<input id="tl_dep" placeholder="Depreciation">
<input id="tl_emi" placeholder="Monthly EMI">
<input id="tl_tenure" placeholder="Tenure (3-7)">
</div>
</div>

<div class="card">
<h3>Agriculture</h3>
<div class="grid">
<input id="ag_profit" placeholder="Net Profit">
<input id="ag_dep" placeholder="Depreciation">
<input id="ag_tax" placeholder="Tax">
<input id="ag_emi" placeholder="Monthly EMI">
<input id="loan_required" placeholder="Loan Required">
<input id="undoc" placeholder="Undocumented Income">
</div>
</div>

<div style="text-align:center">
<button onclick="runAnalysis()">Run Analysis</button>
</div>

<div class="card">
<h3>Dashboard</h3>
<p id="summary"></p>
<canvas id="chart"></canvas>
</div>

<script>

let chart;

function toggleMode(){
 document.body.classList.toggle("light");
}

async function runAnalysis(){
 const payload={
  turnover:turnover.value,
  inventory:inventory.value,
  debtors:debtors.value,
  creditors:creditors.value,
  tl_profit:tl_profit.value,
  tl_dep:tl_dep.value,
  tl_emi:tl_emi.value,
  tl_tenure:tl_tenure.value,
  ag_profit:ag_profit.value,
  ag_dep:ag_dep.value,
  ag_tax:ag_tax.value,
  ag_emi:ag_emi.value,
  loan_required:loan_required.value,
  undoc:undoc.value
 };

 const res=await fetch("https://credit-backend-production-6a6d.up.railway.app/analyze";{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(payload)
 });

 const data=await res.json();

 summary.innerHTML=`
 WC: ₹${data.wc_limit}<br>
 TL: ₹${data.tl_limit}<br>
 Agri: ₹${data.agri_limit}<br>
 Total: ₹${data.total_exposure}<br>
 Rating: ${data.rating}
 `;

 if(chart) chart.destroy();

 chart=new Chart(document.getElementById("chart"),{
  type:"bar",
  data:{
   labels:["WC","TL","Agri"],
   datasets:[{
    data:[data.wc_limit,data.tl_limit,data.agri_limit]
   }]
  }
 });
}

</script>

</body>
</html>
