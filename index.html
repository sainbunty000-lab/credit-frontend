<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI OCR Underwriting Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:#0b1629;
    color:white;
}

header{
    background:#111f3a;
    padding:20px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
}

.container{
    padding:20px;
    max-width:1000px;
    margin:auto;
}

.card{
    background:#16233d;
    padding:20px;
    border-radius:10px;
    margin-bottom:20px;
}

button{
    background:#00bcd4;
    border:none;
    padding:10px 16px;
    border-radius:6px;
    color:white;
    font-weight:bold;
    cursor:pointer;
    margin-top:10px;
}

button:hover{ background:#00acc1; }

.slide{ display:none; }
.slide.active{ display:block; }

.progress{
    height:5px;
    background:#00bcd4;
    width:0%;
    transition:0.4s;
}

.loader{
    border:4px solid #f3f3f3;
    border-top:4px solid #00bcd4;
    border-radius:50%;
    width:40px;
    height:40px;
    animation:spin 1s linear infinite;
    margin:auto;
}

@keyframes spin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
}

.case-item{
    background:#0f1e36;
    padding:10px;
    border-radius:6px;
    margin-bottom:10px;
}

.success{color:#4caf50;}
.warning{color:#ff9800;}
.danger{color:#f44336;}
</style>
</head>

<body>

<header>AI OCR Underwriting Suite</header>
<div class="progress" id="progressBar"></div>

<div class="container">

<!-- Slide 1: Upload -->
<div class="slide active" id="slide1">
<div class="card">
<h3>Upload Scanned Documents</h3>
<input type="file" id="bs" accept=".pdf"><br><br>
<input type="file" id="pl" accept=".pdf"><br><br>
<input type="file" id="bank" accept=".pdf"><br><br>
<button onclick="startAnalysis()">Run OCR Analysis</button>
<button onclick="showSlide(4)">View Case History</button>
</div>
</div>

<!-- Slide 2: Processing -->
<div class="slide" id="slide2">
<div class="card">
<h3>Processing Documents</h3>
<div class="loader"></div>
<p style="text-align:center;">OCR Engine Running...</p>
</div>
</div>

<!-- Slide 3: Result -->
<div class="slide" id="slide3">
<div class="card">
<h3>Underwriting Results</h3>
<div id="results"></div>
<button onclick="showSlide(1)">New Case</button>
<button onclick="showSlide(4)">View History</button>
</div>
</div>

<!-- Slide 4: Storage -->
<div class="slide" id="slide4">
<div class="card">
<h3>Saved Cases</h3>
<div id="caseList"></div>
<button onclick="showSlide(1)">Back</button>
</div>
</div>

</div>

<script>

const API_URL = "https://YOUR_RAILWAY_URL"; // CHANGE THIS

function showSlide(n){
    document.querySelectorAll(".slide").forEach(s=>s.classList.remove("active"));
    document.getElementById("slide"+n).classList.add("active");
    document.getElementById("progressBar").style.width = (n*25)+"%";
    if(n===4) loadCases();
}

async function startAnalysis(){

    const bs = document.getElementById("bs").files[0];
    const pl = document.getElementById("pl").files[0];
    const bank = document.getElementById("bank").files[0];

    if(!bs || !pl || !bank){
        alert("Upload all three scanned PDFs.");
        return;
    }

    showSlide(2);

    const fd = new FormData();
    fd.append("bs_file", bs);
    fd.append("pl_file", pl);
    fd.append("bank_file", bank);

    try{
        const res = await fetch(API_URL + "/analyze", {
            method:"POST",
            body:fd
        });

        const data = await res.json();
        displayResults(data);
        saveCase(data);
        showSlide(3);

    }catch(e){
        alert("Server error. Check Railway backend.");
        showSlide(1);
    }
}

function displayResults(data){

    let riskColor="success";
    if(data.Risk_Score<60) riskColor="danger";
    else if(data.Risk_Score<75) riskColor="warning";

    document.getElementById("results").innerHTML = `
    <b>Case ID:</b> ${data.Case_ID}<br><br>
    <b>Sales:</b> ₹${data.Sales}<br>
    <b>Bank Turnover:</b> ₹${data.Bank_Turnover}<br><br>
    <b>Working Capital:</b> ₹${data.Working_Capital_Limit}<br>
    <b>Agriculture Limit:</b> ₹${data.Agri_Limit}<br><br>
    <b>Mismatch:</b> ${data.Mismatch_%}%<br>
    <b class="${riskColor}">Risk Score:</b> ${data.Risk_Score}<br>
    <b>Decision:</b> ${data.Decision}<br>
    <b>Confidence:</b> ${data.Parsing_Confidence}%<br><br>
    <i>${data.AI_Explanation}</i>
    `;
}

function saveCase(data){
    let cases = JSON.parse(localStorage.getItem("cases")||"[]");
    cases.push(data);
    localStorage.setItem("cases", JSON.stringify(cases));
}

function loadCases(){
    let cases = JSON.parse(localStorage.getItem("cases")||"[]");
    const list = document.getElementById("caseList");
    list.innerHTML="";
    if(cases.length===0){
        list.innerHTML="No saved cases.";
        return;
    }
    cases.forEach((c,index)=>{
        list.innerHTML+=`
        <div class="case-item">
        <b>${c.Case_ID}</b> - ${c.Decision}<br>
        WC: ₹${c.Working_Capital_Limit} |
        Agri: ₹${c.Agri_Limit}<br>
        <button onclick="deleteCase(${index})">Delete</button>
        </div>
        `;
    });
}

function deleteCase(index){
    let cases = JSON.parse(localStorage.getItem("cases")||"[]");
    cases.splice(index,1);
    localStorage.setItem("cases", JSON.stringify(cases));
    loadCases();
}

</script>

</body>
</html>
