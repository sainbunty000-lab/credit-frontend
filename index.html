<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>AI Credit Underwriting Suite</title>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<style>
body {
margin:0;
font-family:'Segoe UI';
background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

header {
text-align:center;
padding:20px;
font-size:22px;
font-weight:bold;
background:rgba(0,0,0,0.3);
backdrop-filter: blur(8px);
}

.container {
max-width:1200px;
margin:auto;
padding:20px;
}

.card {
background:rgba(255,255,255,0.08);
backdrop-filter:blur(10px);
border-radius:15px;
padding:20px;
margin-bottom:20px;
box-shadow:0 8px 32px rgba(0,0,0,0.4);
transition:0.3s;
}

.card:hover {
transform:translateY(-5px);
}

.grid {
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:15px;
}

input, select {
padding:8px;
border:none;
border-radius:8px;
background:rgba(255,255,255,0.15);
color:white;
width:100%;
}

button {
background:linear-gradient(45deg,#00c6ff,#0072ff);
border:none;
padding:10px;
border-radius:8px;
color:white;
font-weight:bold;
cursor:pointer;
transition:0.3s;
}

button:hover {
transform:scale(1.05);
}

.result-box {
padding:15px;
border-radius:12px;
margin-bottom:15px;
background:rgba(255,255,255,0.1);
}

.green {color:#00ff88;}
.orange {color:#ffcc00;}
.red {color:#ff4d4d;}

table {
width:100%;
border-collapse:collapse;
}

th,td {
padding:8px;
text-align:center;
}

th {
background:rgba(255,255,255,0.2);
}

</style>
</head>

<body>

<header>AI Powered Credit Underwriting Intelligence</header>

<div id="root" class="container"></div>

<script type="text/babel">

const API_URL="https://credit-backend-yh78.onrender.com";

function App(){

const [form,setForm]=React.useState({
sales:"",pat:"",dep:"",stock:"",debtors:"",
creditors:"",loan_req:"",emi:"",undocumented:"",bounce:""
});

const [docType,setDocType]=React.useState("");
const [file,setFile]=React.useState(null);
const [docResult,setDocResult]=React.useState(null);
const [result,setResult]=React.useState(null);
const [cases,setCases]=React.useState([]);

const formatCurrency=(n)=>"‚Çπ"+Number(n).toLocaleString("en-IN");

const riskColor=(score)=>{
if(score>=80) return "green";
if(score>=60) return "orange";
return "red";
};

const handleChange=e=>setForm({...form,[e.target.name]:e.target.value});

const uploadDocument=async()=>{
if(!file||!docType) return alert("Select document type and file");

const formData=new FormData();
formData.append("file",file);
formData.append("doc_type",docType);

const res=await fetch(API_URL+"/parse-document",{method:"POST",body:formData});
const data=await res.json();
setDocResult(data);

if(docType==="pl"){
setForm(f=>({...f,sales:data.Sales||"",pat:data.Net_Profit||"",dep:data.Depreciation||""}));
}
if(docType==="bs"){
setForm(f=>({...f,stock:data.Inventory||"",debtors:data.Debtors||"",creditors:data.Creditors||""}));
}
if(docType==="bank"){
setForm(f=>({...f,bounce:data.Bounce_Count||""}));
}
};

const analyze=async()=>{
const res=await fetch(API_URL+"/analyze",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(Object.fromEntries(Object.entries(form).map(([k,v])=>[k,Number(v)])))
});
const data=await res.json();
setResult(data);
fetchCases();
};

const fetchCases=async()=>{
const res=await fetch(API_URL+"/cases");
const data=await res.json();
setCases(data);
};

React.useEffect(()=>{fetchCases();},[]);

return(
<div>

{/* Upload Section */}
<div className="card">
<h3>Smart Document Upload</h3>
<select onChange={(e)=>setDocType(e.target.value)}>
<option value="">Select Type</option>
<option value="bank">Bank Statement</option>
<option value="bs">Balance Sheet</option>
<option value="pl">P&L Statement</option>
</select>
<br/><br/>
<input type="file" onChange={(e)=>setFile(e.target.files[0])}/>
<br/><br/>
<button onClick={uploadDocument}>Parse Document</button>
{docResult && <pre>{JSON.stringify(docResult,null,2)}</pre>}
</div>

{/* Financial Form */}
<div className="card">
<h3>Financial Inputs</h3>
<div className="grid">
{Object.keys(form).map(key=>(
<div key={key}>
<label>{key}</label>
<input name={key} value={form[key]} onChange={handleChange}/>
</div>
))}
</div>
<br/>
<button onClick={analyze}>Run AI Credit Analysis</button>
</div>

{/* Results */}
{result && (
<div className="card">
<h3>Underwriting Results</h3>

<div className="result-box">
<h4>üåæ Agriculture Lending</h4>
<p>{formatCurrency(result.Agri_Eligible_Limit)}</p>
</div>

<div className="result-box">
<h4>üè≠ Working Capital</h4>
<p>{formatCurrency(result.Working_Capital_Limit)}</p>
</div>

<div className="result-box">
<h4>üìä Risk Intelligence</h4>
<p>Score: <span className={riskColor(result.Risk_Score)}>{result.Risk_Score}</span></p>
<p>Grade: {result.Risk_Grade}</p>
<p>Decision: {result.Decision}</p>
</div>

<div className="result-box">
<h4>üìà Ratio Dashboard</h4>
<p>Profit Margin: {result.Profit_Margin}%</p>
<p>Current Ratio: {result.Current_Ratio}</p>
<p>WC Gap: {formatCurrency(result.Working_Capital_Gap)}</p>
<p>Banking Health: {result.Banking_Health}</p>
</div>

<a href={API_URL+"/generate-cam/"+result.Case_ID} target="_blank">
<button>Download CAM Report</button>
</a>

</div>
)}

{/* Case History */}
<div className="card">
<h3>Case History</h3>
<table>
<thead>
<tr>
<th>Date</th>
<th>Case ID</th>
<th>Agri</th>
<th>WC</th>
<th>Risk</th>
<th>Decision</th>
</tr>
</thead>
<tbody>
{cases.map((c,i)=>(
<tr key={i}>
<td>{c.Created_At}</td>
<td>{c.Case_ID.substring(0,8)}</td>
<td>{formatCurrency(c.Agri_Limit)}</td>
<td>{formatCurrency(c.WC_Limit)}</td>
<td className={riskColor(c.Risk_Score)}>{c.Risk_Score}</td>
<td>{c.Decision}</td>
</tr>
))}
</tbody>
</table>
</div>

</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>

</body>
</html>
